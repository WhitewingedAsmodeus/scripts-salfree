(function() {
    'use strict';

    const wait = setInterval(() => {
        if (typeof ig !== 'undefined' && ig.game) {
            clearInterval(wait);
            initCinemaUI();
        }
    }, 100);

    function initCinemaUI() {
        if (document.getElementById('cinemaBoard')) return;

        const board = document.createElement('div');
        board.id = 'cinemaBoard';
        board.style.cssText = `
            position:fixed; top:20px; right:20px; width:180px; padding:5px;
            background:rgba(191,188,184,0.85);
            border-top:2px solid #efeeec;
            border-left:2px solid #efeeec;
            border-bottom:2px solid #6f6d69;
            border-right:2px solid #6f6d69;
            font-family:sans-serif; font-size:12px; color:#000;
            z-index:9999; cursor:grab; box-sizing:border-box;
        `;
        document.body.appendChild(board);

        let dragging = false, ox, oy;
        board.onmousedown = e => { dragging = true; ox = e.clientX - board.offsetLeft; oy = e.clientY - board.offsetTop; board.style.cursor = 'grabbing'; };
        document.onmouseup = () => { dragging = false; board.style.cursor = 'grab'; };
        document.onmousemove = e => { if(dragging){ board.style.left = e.clientX - ox + 'px'; board.style.top = e.clientY - oy + 'px'; } };

        const titleBar = document.createElement('div');
        titleBar.style.cssText = 'display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;';
        board.appendChild(titleBar);

        const title = document.createElement('div');
        title.textContent = 'CINEMA MODE';
        title.style.cssText = 'font-weight:bold; font-size:12px;';
        titleBar.appendChild(title);

        const closeBtn = document.createElement('div');
        closeBtn.textContent = 'âœ–';
        closeBtn.style.cssText = 'cursor:pointer; font-weight:bold; user-select:none;';
        titleBar.appendChild(closeBtn);

        closeBtn.onclick = () => board.remove();

        const toggleBtn = document.createElement('button');
        toggleBtn.textContent = 'CINEMA';
        board.appendChild(toggleBtn);

        function updateButton(isOn) {
            toggleBtn.style.cssText = `
                width:100%; padding:2px 0;
                background:rgba(198,195,191,0.85);
                border-top:2px solid ${isOn ? '#6f6d69' : '#efeeec'};
                border-left:2px solid ${isOn ? '#6f6d69' : '#efeeec'};
                border-bottom:2px solid ${isOn ? '#efeeec' : '#6f6d69'};
                border-right:2px solid ${isOn ? '#efeeec' : '#6f6d69'};
                cursor:pointer;
                outline:none;
                user-select:none;
                -webkit-tap-highlight-color:transparent;
            `;
        }

        let cinemaOn = false;
        updateButton(cinemaOn);

        toggleBtn.onclick = () => {
            cinemaOn = !cinemaOn;
            ig.game.cameraTrackPlayer = !cinemaOn;
            updateButton(cinemaOn);
            console.log(`Cinema Mode ${cinemaOn ? 'Enabled' : 'Disabled'}`);
        };

        toggleBtn.onmousedown = e => e.preventDefault();
    }
})();

